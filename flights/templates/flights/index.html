<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscador de Vuelos</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
    }

    * { box-sizing: border-box; }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 40px;
    }

    .logo {
      font-size: 28px;
      font-weight: bold;
      color: #2d3748;
    }

    .search-card {
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      margin-bottom: 40px;
    }

    .search-title {
      font-size: 32px;
      font-weight: bold;
      color: #2d3748;
      margin-bottom: 10px;
    }

    .search-subtitle {
      font-size: 18px;
      color: #718096;
      margin-bottom: 30px;
    }

    .trip-type {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .radio-option input[type="radio"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .radio-option label {
      font-size: 16px;
      color: #4a5568;
      cursor: pointer;
    }

    .search-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .form-group { display: flex; flex-direction: column; }

    .form-group label {
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 8px;
    }

    .form-group input,
    .form-group select {
      padding: 14px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .passengers-group {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .search-button {
      background: #667eea;
      color: white;
      border: none;
      padding: 16px 40px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      margin-top: 10px;
    }

    .search-button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      margin-top: 40px;
    }

    .feature-card {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .feature-icon { font-size: 48px; margin-bottom: 15px; }

    .feature-title {
      font-size: 20px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 10px;
    }

    .feature-description { font-size: 14px; color: #718096; line-height: 1.6; }

    @media (max-width: 768px) {
      .search-form { grid-template-columns: 1fr; }
      .passengers-group { grid-template-columns: 1fr; }
      .search-card { padding: 25px; }
      .search-title { font-size: 24px; }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <header class="header" style="display:flex;justify-content:space-between;align-items:center;">
  <div class="logo" id="site-title">Aerol√≠neas Premium</div>
  <nav style="display:flex;gap:20px;align-items:center;">
    <a href="/flights/mis-reservas/" style="text-decoration:none;font-weight:600;color:#4a5568;">Mis reservas</a>
    <a href="/login/" id="login-link" style="text-decoration:none;font-weight:600;color:#4a5568;">Iniciar sesi√≥n</a>
  </nav>
</header>


  <div class="container">
   <div class="search-card">
    <h1 class="search-title" id="search-title">Encuentra tu vuelo ideal</h1>
    <p class="search-subtitle" id="search-subtitle">Busca y compara vuelos a los mejores destinos</p>

    <div class="trip-type">
     <div class="radio-option">
       <input type="radio" id="ida-vuelta" name="trip-type" value="round-trip" checked>
       <label for="ida-vuelta">Ida y vuelta</label>
     </div>
     <div class="radio-option">
       <input type="radio" id="solo-ida" name="trip-type" value="one-way">
       <label for="solo-ida">Solo ida</label>
     </div>
     <div class="radio-option">
       <input type="radio" id="multidestino" name="trip-type" value="multi-city">
       <label for="multidestino">Multidestino</label>
     </div>
    </div>

    <form class="search-form" id="search-form">
     <div class="form-group">
       <label for="origen">Origen</label>
       <input type="text" id="origen" placeholder="¬øDesde d√≥nde viajas?" required>
     </div>

     <div class="form-group">
       <label for="destino">Destino</label>
       <input type="text" id="destino" placeholder="¬øA d√≥nde quieres ir?" required>
     </div>

     <div class="form-group">
       <label for="fecha-ida">Fecha de ida</label>
       <input type="date" id="fecha-ida" required>
     </div>

     <div class="form-group" id="fecha-vuelta-group">
       <label for="fecha-vuelta">Fecha de vuelta</label>
       <input type="date" id="fecha-vuelta">
     </div>

     <div class="form-group">
       <label>Pasajeros</label>
       <div class="passengers-group">
         <select id="adultos" aria-label="Adultos">
           <option value="1">1 Adulto</option>
           <option value="2">2 Adultos</option>
           <option value="3">3 Adultos</option>
           <option value="4">4 Adultos</option>
         </select>
         <select id="ninos" aria-label="Ni√±os">
           <option value="0">0 Ni√±os</option>
           <option value="1">1 Ni√±o</option>
           <option value="2">2 Ni√±os</option>
           <option value="3">3 Ni√±os</option>
         </select>
         <select id="bebes" aria-label="Beb√©s">
           <option value="0">0 Beb√©s</option>
           <option value="1">1 Beb√©</option>
           <option value="2">2 Beb√©s</option>
         </select>
       </div>
     </div>

     <div class="form-group">
       <label for="clase">Clase</label>
       <select id="clase">
         <option value="economica">Econ√≥mica</option>
         <option value="premium">Premium Economy</option>
         <option value="business">Business</option>
         <option value="primera">Primera Clase</option>
       </select>
     </div>
    </form>

    <button class="search-button" id="search-button">Buscar vuelos</button>
   </div>

   <!-- Resultados de la b√∫squeda -->
   <div id="results" class="container" style="margin-top: 20px;"></div>

   <div class="features">
    <div class="feature-card">
     <div class="feature-icon">‚úàÔ∏è</div>
     <h3 class="feature-title">Mejores Precios</h3>
     <p class="feature-description">Encuentra las tarifas m√°s competitivas del mercado con nuestra garant√≠a de mejor precio</p>
    </div>
    <div class="feature-card">
     <div class="feature-icon">üåç</div>
     <h3 class="feature-title">Destinos Globales</h3>
     <p class="feature-description">Vuela a m√°s de 150 destinos en todo el mundo con las mejores conexiones</p>
    </div>
    <div class="feature-card">
     <div class="feature-icon">üé´</div>
     <h3 class="feature-title">Reserva Flexible</h3>
     <p class="feature-description">Cambia o cancela tu vuelo sin complicaciones con nuestras pol√≠ticas flexibles</p>
    </div>
   </div>
  </div>

  <script>
    // --- Config editable (opcional) ---
    const defaultConfig = {
      site_title: "Aerol√≠neas Premium",
      search_title: "Encuentra tu vuelo ideal",
      search_subtitle: "Busca y compara vuelos a los mejores destinos",
      button_text: "Buscar vuelos",
      primary_color: "#667eea",
      secondary_color: "#764ba2",
      background_color: "#ffffff",
      text_color: "#2d3748",
      accent_color: "#5568d3",
      font_family: "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif",
      font_size: 16
    };

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Arial, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;

      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

      document.getElementById('site-title').textContent = config.site_title || defaultConfig.site_title;
      document.getElementById('search-title').textContent = config.search_title || defaultConfig.search_title;
      document.getElementById('search-subtitle').textContent = config.search_subtitle || defaultConfig.search_subtitle;
      document.getElementById('search-button').textContent = config.button_text || defaultConfig.button_text;

      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const textColor = config.text_color || defaultConfig.text_color;

      document.body.style.background =
        `linear-gradient(135deg, ${primaryColor} 0%, ${config.secondary_color || defaultConfig.secondary_color} 100%)`;

      const searchButton = document.getElementById('search-button');
      searchButton.style.background = primaryColor;
      searchButton.style.fontSize = `${baseSize * 1.125}px`;

      const searchCard = document.querySelector('.search-card');
      searchCard.style.background = backgroundColor;

      const header = document.querySelector('.header');
      header.style.background = `rgba(255, 255, 255, 0.95)`;

      const siteTitle = document.getElementById('site-title');
      siteTitle.style.color = textColor;
      siteTitle.style.fontSize = `${baseSize * 1.75}px`;

      const searchTitle = document.getElementById('search-title');
      searchTitle.style.color = textColor;
      searchTitle.style.fontSize = `${baseSize * 2}px`;

      document.getElementById('search-subtitle').style.fontSize = `${baseSize * 1.125}px`;

      const featureTitles = document.querySelectorAll('.feature-title');
      featureTitles.forEach(title => {
        title.style.color = textColor;
        title.style.fontSize = `${baseSize * 1.25}px`;
      });

      const featureDescriptions = document.querySelectorAll('.feature-description');
      featureDescriptions.forEach(desc => {
        desc.style.fontSize = `${baseSize * 0.875}px`;
      });

      const labels = document.querySelectorAll('.form-group label, .radio-option label');
      labels.forEach(label => { label.style.fontSize = `${baseSize}px`; });

      const inputs = document.querySelectorAll('.form-group input, .form-group select');
      inputs.forEach(input => { input.style.fontSize = `${baseSize}px`; });
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          { get: () => config.background_color || defaultConfig.background_color,
            set: (value) => { config.background_color = value; window.elementSdk.setConfig({ background_color: value }); } },
          { get: () => config.primary_color || defaultConfig.primary_color,
            set: (value) => { config.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); } },
          { get: () => config.text_color || defaultConfig.text_color,
            set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); } },
          { get: () => config.accent_color || defaultConfig.accent_color,
            set: (value) => { config.accent_color = value; window.elementSdk.setConfig({ accent_color: value }); } },
          { get: () => config.secondary_color || defaultConfig.secondary_color,
            set: (value) => { config.secondary_color = value; window.elementSdk.setConfig({ secondary_color: value }); } }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => { config.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["site_title", config.site_title || defaultConfig.site_title],
        ["search_title", config.search_title || defaultConfig.search_title],
        ["search_subtitle", config.search_subtitle || defaultConfig.search_subtitle],
        ["button_text", config.button_text || defaultConfig.button_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    // --- L√≥gica de tipo de viaje (mostrar/ocultar fecha de vuelta) ---
    const tripTypeRadios = document.querySelectorAll('input[name="trip-type"]');
    const fechaVueltaGroup = document.getElementById('fecha-vuelta-group');
    const fechaVueltaInput = document.getElementById('fecha-vuelta');

    tripTypeRadios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        if (e.target.value === 'one-way' || e.target.value === 'multi-city') {
          fechaVueltaGroup.style.display = 'none';
          fechaVueltaInput.removeAttribute('required');
          fechaVueltaInput.value = '';
        } else {
          fechaVueltaGroup.style.display = 'flex';
          fechaVueltaInput.setAttribute('required', '');
        }
      });
    });

    // Evita submit nativo (manejado por JS)
    document.getElementById('search-form').addEventListener('submit', (e) => e.preventDefault());

    // --- Render de resultados y conexi√≥n al backend /flights/api/vuelos/buscar/ ---
    function renderResults(list) {
      const box = document.getElementById('results');
      if (!list.length) {
        box.innerHTML = `<div class="feature-card">No hay vuelos para los filtros seleccionados.</div>`;
        return;
      }
      const items = list.map(v => {
        const salida = new Date(v.departure_time).toLocaleString();
        const llegada = new Date(v.arrival_time).toLocaleString();
        return `
          <div class="feature-card" style="text-align:left">
            <div class="feature-title">Vuelo ${v.flight_number}</div>
            <div class="feature-description">
              ${v.origin} ‚Üí ${v.destination}<br>
              Sale: ${salida}<br>
              Llega: ${llegada}<br>
              Avi√≥n: ${v.aircraft?.model_name || '-'}
            </div>
            <div style="margin-top:10px">
              <a href="/flights/${v.id}/" class="search-button" style="display:inline-block;padding:10px 16px;text-decoration:none">Ver detalle</a>
            </div>
          </div>`;
      }).join('');
      box.innerHTML = `<div class="features">${items}</div>`;
    }

    document.getElementById('search-button').addEventListener('click', async (e) => {
      e.preventDefault();
      const form = document.getElementById('search-form');
      if (!form.checkValidity()) { form.reportValidity(); return; }

      const origin = document.getElementById('origen').value.trim();
      const destination = document.getElementById('destino').value.trim();
      const date = document.getElementById('fecha-ida').value; // YYYY-MM-DD

      // Bot√≥n: feedback de carga
      const btn = document.getElementById('search-button');
      const original = btn.textContent;
      btn.textContent = 'Buscando...'; btn.disabled = true;

      try {
        const qs = new URLSearchParams({ origin, destination, date }).toString();
        const resp = await fetch(`/flights/api/vuelos/buscar/?${qs}`);
        if (!resp.ok) throw new Error('No se pudo buscar vuelos');
        const data = await resp.json();
        renderResults(data);
        btn.textContent = '¬°Vuelos encontrados!';
      } catch (err) {
        document.getElementById('results').innerHTML =
          `<div class="feature-card">Error: ${err.message}</div>`;
        btn.textContent = 'Reintentar';
      } finally {
        setTimeout(() => { btn.textContent = original; btn.disabled = false; }, 1200);
      }
    });

    // --- Fechas m√≠nimas (hoy hacia adelante) ---
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('fecha-ida').setAttribute('min', today);
    document.getElementById('fecha-vuelta').setAttribute('min', today);
  </script>

  <!-- (Opcional) Script externo inyectado por CF u otros (puede omitirse si no aplica a tu despliegue) -->
  <!--
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99cf1b7555117f36',t:'MTc2Mjg3NzkyNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
  -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem('access_token');
    const loginLink = document.getElementById('login-link');

    if (token) {
      loginLink.textContent = 'Cerrar sesi√≥n';
      loginLink.href = '#';
      loginLink.addEventListener('click', (e) => {
        e.preventDefault();
        localStorage.removeItem('access_token');
        alert('Sesi√≥n cerrada');
        window.location.reload();
      });
    }
  });
</script>

 </body>
</html>
